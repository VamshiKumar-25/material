1. create a folder my_webapp and move into it
2. create a 

app.py file -> 
from flask import Flask
app=Flask(__name__)

@app.route("/")
def home():
	return "Hello from Jenikins Pipeline Demo"

if __name__ == "__main__":
	app.run(host='0.0.0.0', port=5000)
--------------------------------------------------
requirements.txt ->
flask
--------------------------------------------------
Dockerfile ->
FROM python:3.10-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
EXPOSE 5000
CMD ["python","app.py"]
-------------------------------------------------

3. Build the image and run locally as a part of test
-> docker build -t my_webapp .
-> docker run -p 5000:5000 my_webapp:latest
*******************************************************
INITIALIZE AS A GIT REPO AND PUSH TO GITHUB
1. -> git init
-> git branch -m main
-> git add .
-> git commit -m "Initial Commit"

2. Create a Github repo
* Goto Github.com -> New Repo -> name:my_webapp -> create
* Add Github remote (SSH recommended) -> git remote add origin <ssh-url-of-github-repo>

3. Generate SSH key and add it to github
* ssh-keygen -t ed25519 -C "<mailId-same-as-github-is-recommended>"
* cat ~/.ssh/id_ed25519.pub -> copy the key
* Goto Github.com->settings->ssh and gpg keys -> new ssh key -> paste the key and save
* test the connection from terminal -> ssh -T git@github.com

4. push the code to github repo
* git push origin main
****************************************************
CONFIGURE DOCKER HUB CREDENTIALS
1. Login to Docker Hub
2. create a new repo: my_webapp
3. Add Docker Hub Credentials to Jenkins
* Goto jenkins -> Manage Jenkins -> Credentials -> Global -> Add credentials 
	choose: kind: username and password
		ID: dockerhub
		username: <dockerhub_username>
		password: <dockerhub_password>
***************************************************
INSTALL THESE PLUGINS IF NOT ALREADY

1. Goto Jenkins -> Manage Jenkins -> Plugins 
* Git Plugin
* Pipeline
* Docker Pipeline
* Credential Binding
2. Restart jenkins -> sudo systemctl restart jenkins 
***************************************************
CONFIGURE JENKINS SSH ACCESS TO GITHUB
1. Jenkins must clone your repo using SSH
* switch to jenkins user-> sudo -su jenkins
* Generate SSH key -> ssh-keygen -t ed25519 -C "jenkins@server"
* display the public key -> cat ~/.ssh/id_ed25519.pub -> copy the key and add to github 
2. Add Github to known Hosts
* ssh-keyscan github.com >> ~/.ssh/known_hosts
* chmod 600 ~/.ssh/known_hosts
3. Test the connection to github -> ssh -T git@github.com

*******************************************************************
CREATE A JENKINS FILE AND ADD TO YOUR GITHUB REPO
1. create a 'jenkinsfile' ->
pipeline {
	agent any
	environment {
		DOCKERHUB_CRED=credentials('dockerhub')
		IMAGE_NAME="<docker_hub_username>/<docker_hub_repo_name>"
	}
	
	stages {
		stage('checkout') {
			steps {
				git url:'<github_repo_ssh_url>', branch:'main' 
			}
		}
		
		stage('Build Docker Image') {
			steps {
				script {
					dockerImage=docker.build("${IMAGE_NAME}:latest")
				}
			}
		}
		
		stage('Push to DockerHub') {
			steps {
				script {
					docker.withRegistry('https://index.docker.io/v1/','dockerhub') {
						dockerImage.push()
					}
				}
			}
		}
	}
	
	post {
		success {
			echo "Pipeline Successful"
		}
		failure {
			echo "Pipeline Failed"
		}
		always {
			echo "Cleaning Up WorkSpace"
			deleteDir()
		}
	}
}

2. add, commit and push to githun repo
	* git add .
	* git commit -m "Added Jenkins File"
	* git push origin main

*************************************************************************
ADD JENKINS TO DOCKER GROUP
1. This is needed because jenkins need permission to execute docker commands
-> sudo usermod -aG docker jenkins
-> sudo systemctl restart docker
-> sudo systemctl restart jenkins


*************************************************************************
CREATE JENKINS PIPELINE JOB
1. Goto Jenkins -> New Item -> Pipeline -> OK
2. Configure Pipeline -> * pipeline -> choose from SCM
			 * SCM -> Git
			 * Repo Url: <ssh_url_of_github_repo>
			 * script path: jenkinsfile
	Save -> Build Now

**************************************************************************
VERIFY IN DOCKERHUB
* Goto DockerHub Repo and look for the image pushed.

***************************************************************************
Kubernetes Deployment

-> kubectl create deployment flaskapp --image=reponame/imagename:tag
-> kubectl expose deployment flaskapp --type=NodePort -p 3000:8080 
-> minikube service flaskapp

***************************************************************************
Docker swarm

-> docker swarm init
-> docker service create --name flaskapp --replicas 3 -p published 3001:3000 reponame/imagename:tag


